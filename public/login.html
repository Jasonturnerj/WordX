<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link rel="stylesheet" href="src/accounts.css">
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
</head>
<body>
    <h1>Wordx</h1>
    <h2>Login</h2>
    <form action="/login" method="POST">
        <label for="username">Username:</label>
        <input type="text" id="username" name="username" required><br>
        <label for="password">Password:</label>
        <input type="password" id="password" name="password" required><br>
        <input type="submit" value="login">
    </form>
<div id="username-error"></div>
<div id="password-error"></div>
<div id="invalid-error"></div>

    <script><!-- Modal -->
    document.getElementById('loginForm').addEventListener('submit', async function(event) {
        event.preventDefault();
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;
    
        // Clear previous errors
        document.getElementById('username-error').textContent = '';
        document.getElementById('password-error').textContent = '';
        document.getElementById('invalid-error').textContent = '';
    
        let valid = true;
    
        if (!username) {
            displayError('username-error', 'Username is required.');
            valid = false;
        }
        if (!password) {
            displayError('password-error', 'Password is required.');
            valid = false;
        }
    
        if (!valid) return;
    
        try {
            const response = await fetch('/login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ username, password }),
            });
    
            if (response.status === 404 || response.status === 401) {
                const result = await response.json();
                if (response.status === 404) {
                    displayError('username-error', result.error);
                } else if (response.status === 401) {
                    displayError('password-error', result.error);
                }
            } else if (response.status === 200) {
                const result = await response.json();
                window.location.href = result.redirect; // Redirect to game screen upon successful login
            }
        } catch (error) {
            console.error('Error:', error);
            displayError('invalid-error', 'Unexpected error occurred. Please try again.');
        }
    });
    
    function displayError(elementId, message) {
        const errorElement = document.getElementById(elementId);
        errorElement.textContent = message;
        errorElement.classList.add('alert', 'alert-danger'); // Add Bootstrap alert class
    }
</script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-q6QX1QNrkRYwKoOJDg3C6uJ0Z4h1yeRjcHXde0J6mGSlZUzfLREx7UEN0u8D9L8z" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js" integrity="sha384-z2oLAhRjmIvbOHImzR8HUr6k+fgy3MWyUI8+0+dn+k5do2n6wW5z3Md8jMsS8p3I" crossorigin="anonymous"></script>
</html>
